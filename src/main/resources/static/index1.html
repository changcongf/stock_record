<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>股票复盘记录系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">股票复盘记录系统</h1>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily" type="button" role="tab" aria-controls="daily" aria-selected="true">大盘复盘</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="company-tab" data-bs-toggle="tab" data-bs-target="#company" type="button" role="tab" aria-controls="company" aria-selected="false">个股复盘</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="daily" role="tabpanel" aria-labelledby="daily-tab">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">大盘复盘记录</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="dailyDate" class="form-label">选择日期</label>
                        <input type="date" class="form-control" id="dailyDate">
                    </div>
                    <div class="mb-3">
                        <label for="dailyContent" class="form-label">复盘内容</label>
                        <textarea class="form-control" id="dailyContent" rows="10" placeholder="请输入大盘复盘内容..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="dailyInfo" class="form-label">附加信息</label>
                        <textarea class="form-control" id="dailyInfo" rows="3" placeholder="请输入附加信息..."></textarea>
                    </div>
                    <button id="saveDailyBtn" class="btn btn-primary">保存复盘</button>
                    <button id="loadDailyBtn" class="btn btn-secondary">加载复盘</button>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="company" role="tabpanel" aria-labelledby="company-tab">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">个股复盘记录</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="companyDate" class="form-label">选择日期</label>
                        <input type="date" class="form-control" id="companyDate">
                    </div>
                    <div class="mb-3">
                        <label for="companyName" class="form-label">股票代码/名称</label>
                        <input type="text" class="form-control" id="companyName" placeholder="例如：600000 或 浦发银行">
                    </div>
                    <div class="mb-3">
                        <label for="companyContent" class="form-label">复盘内容</label>
                        <textarea class="form-control" id="companyContent" rows="10" placeholder="请输入个股复盘内容..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="companyInfo" class="form-label">附加信息</label>
                        <textarea class="form-control" id="companyInfo" rows="3" placeholder="请输入附加信息..."></textarea>
                    </div>
                    <button id="saveCompanyBtn" class="btn btn-success">保存复盘</button>
                    <button id="loadCompanyBtn" class="btn btn-secondary">加载复盘</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 设置默认日期为今天
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('dailyDate').value = today;
        document.getElementById('companyDate').value = today;

        // 大盘复盘保存
        document.getElementById('saveDailyBtn').addEventListener('click', function() {
            const date = document.getElementById('dailyDate').value;
            const content = document.getElementById('dailyContent').value;
            const info = document.getElementById('dailyInfo').value;

            fetch('/api/daily-records', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    currentDay: date,
                    content: content,
                    info: info
                })
            })
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error('保存失败');
                })
                .then(data => {
                    alert('大盘复盘保存成功！');
                    console.log('保存成功:', data);
                })
                .catch(error => {
                    alert('保存失败: ' + error.message);
                    console.error('Error:', error);
                });
        });

        // 大盘复盘加载
        document.getElementById('loadDailyBtn').addEventListener('click', function() {
            const date = document.getElementById('dailyDate').value;

            fetch(`/api/daily-records/${date}`)
                .then(response => {
                    if (response.ok) return response.json();
                    if (response.status === 404) throw new Error('该日期无复盘记录');
                    throw new Error('加载失败');
                })
                .then(data => {
                    document.getElementById('dailyContent').value = data.content || '';
                    document.getElementById('dailyInfo').value = data.info || '';
                    alert('大盘复盘加载成功！');
                })
                .catch(error => {
                    alert('加载失败: ' + error.message);
                    console.error('Error:', error);
                });
        });

        // 个股复盘保存
        document.getElementById('saveCompanyBtn').addEventListener('click', function() {
            const date = document.getElementById('companyDate').value;
            const company = document.getElementById('companyName').value;
            const content = document.getElementById('companyContent').value;
            const info = document.getElementById('companyInfo').value;

            if (!company) {
                alert('请输入股票代码或名称');
                return;
            }

            fetch('/api/company-records', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    currentDay: date,
                    company: company,
                    content: content,
                    info: info
                })
            })
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error('保存失败');
                })
                .then(data => {
                    alert('个股复盘保存成功！');
                    console.log('保存成功:', data);
                })
                .catch(error => {
                    alert('保存失败: ' + error.message);
                    console.error('Error:', error);
                });
        });

        // 个股复盘加载
        document.getElementById('loadCompanyBtn').addEventListener('click', function() {
            const date = document.getElementById('companyDate').value;
            const company = document.getElementById('companyName').value;

            if (!company) {
                alert('请输入股票代码或名称');
                return;
            }

            fetch(`/api/company-records/search?day=${date}&company=${company}`)
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error('加载失败');
                })
                .then(data => {
                    if (data.length > 0) {
                        document.getElementById('companyContent').value = data[0].content || '';
                        document.getElementById('companyInfo').value = data[0].info || '';
                        alert('个股复盘加载成功！');
                    } else {
                        alert('未找到该股票在该日期的复盘记录');
                        document.getElementById('companyContent').value = '';
                        document.getElementById('companyInfo').value = '';
                    }
                })
                .catch(error => {
                    alert('加载失败: ' + error.message);
                    console.error('Error:', error);
                });
        });
    });
</script>
</body>
</html>