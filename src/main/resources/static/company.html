<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px; /* å¢åŠ å†…è¾¹è· */
            background-color: #f8f9fa;
            border-radius: 10px; /* å¢åŠ åœ†è§’ */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* æ·»åŠ é˜´å½±æ•ˆæœ */
            min-width: 400px; /* è®¾ç½®æœ€å°å®½åº¦ */
            width: auto; /* è‡ªé€‚åº”å®½åº¦ */
        }
        .header label {
            font-size: 18px; /* å¢å¤§å­—ä½“ */
            font-weight: 600; /* åŠ ç²— */
            margin-right: 15px; /* å¢åŠ æ ‡ç­¾å³è¾¹è· */
            color: #333; /* è®¾ç½®æ ‡ç­¾é¢œè‰² */
        }
        .header input {
            font-size: 16px; /* å¢å¤§è¾“å…¥æ¡†å­—ä½“ */
            padding: 12px 15px; /* å¢åŠ è¾“å…¥æ¡†å†…è¾¹è· */
            border: 2px solid #ddd; /* è®¾ç½®è¾¹æ¡† */
            border-radius: 6px; /* è¾“å…¥æ¡†åœ†è§’ */
            outline: none; /* ç§»é™¤é»˜è®¤è½®å»“ */
            width: 250px; /* ç¼©çŸ­ä¸ºåŸæ¥çš„1/5 */
            transition: border-color 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
        }
        .header input:focus {
            border-color: #007bff; /* èšç„¦æ—¶è¾¹æ¡†é¢œè‰² */
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1); /* èšç„¦æ—¶é˜´å½± */
        }
        .main-content {
            display: flex;
            gap: 20px;
        }
        .left-panel {
            flex: 8; /* å·¦ä¾§æ›´å®½ */
            min-width: 0;
        }
        .right-panel {
            flex: 1; /* å³ä¾§æ›´çª„ */
            min-width: 200px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 13px;
        }
        input, textarea, select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 13px;
        }
        button {
            /* é»˜è®¤è“è‰²æŒ‰é’®æ ·å¼ */
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 3px;
            margin-bottom: 3px;
            font-size: 12px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.save-btn, /* æ–°å¢ç°è‰²æŒ‰é’®ç±» */
        button.advanced-search-btn {
            background-color: #6c757d; /* ç»Ÿä¸€ä¸ºç°è‰² */
        }
        button.save-btn:hover,
        button.advanced-search-btn:hover {
            background-color: #545b62; /* ç»Ÿä¸€ä¸ºç°è‰²æ‚¬åœè‰² */
        }
        button.add-attention-btn {
            background-color: #6c757d;
        }
        button.add-attention-btn:hover {
            background-color: #545b62;
        }
        button.comment-icon-btn, /* è¯„è®ºå›¾æ ‡æŒ‰é’®å’Œè¯„è®ºå±•å¼€å›¾æ ‡æŒ‰é’®æ ·å¼ */
        button.comments-toggle-btn {
            background-color: transparent;
            color: #6c757d;
            border: 1px solid #6c757d;
            padding: 2px 5px;
            font-size: 11px;
            display: flex; /* ä½¿ç”¨flexå¸ƒå±€å¯¹é½å›¾æ ‡å’Œæ–‡å­— */
            align-items: center;
            gap: 2px; /* å›¾æ ‡å’Œæ–‡å­—é—´è· */
        }
        button.comment-icon-btn:hover,
        button.comments-toggle-btn:hover {
            background-color: #6c757d;
            color: white;
        }
        .attention-form {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        .attention-form.show {
            display: block;
        }
        .advanced-search {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        .advanced-search.show {
            display: block;
        }
        .comment-form {
            margin-top: 10px;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            display: none;
        }
        .comment-form.show {
            display: block;
        }
        .record-item {
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #fafafa;
            position: relative; /* ä¸ºè¯„è®ºæŒ‰é’®å®šä½ */
        }
        .record-header {
            font-weight: bold;
            margin-bottom: 3px;
            font-size: 14px;
            display: flex; /* ä½¿ç”¨flexå¸ƒå±€ */
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
        }
        .record-info {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            display: flex; /* ä½¿ç”¨flexå¸ƒå±€ */
            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
        }
        .record-content {
            margin-bottom: 8px;
            font-size: 13px;
        }
        .comments-section {
            margin-top: 8px;
        }
        .comments-list {
            display: none; /* é»˜è®¤éšè— */
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #eee;
        }
        .comments-section.expanded .comments-list {
            display: block; /* å±•å¼€æ—¶æ˜¾ç¤º */
        }
        .comment-item {
            background-color: #dee2e6;
            padding: 5px;
            margin: 3px 0;
            border-radius: 3px;
            font-size: 12px;
        }
        .comment-header {
            font-weight: bold;
            margin-bottom: 2px;
            display: inline; /* ä¸infoåŒè¡Œ */
        }
        .comment-info {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
            display: inline; /* ä¸headeråŒè¡Œ */
        }
        .comment-content {
            font-size: 12px;
        }
        .record-actions { /* è®°å½•å³ä¾§æ“ä½œåŒº */
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ—å›¾æ ‡ */
            gap: 5px; /* å›¾æ ‡é—´è· */
        }
        .pagination {
            text-align: center;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px; /* æ·»åŠ æŒ‰é’®é—´è· */
        }
        .pagination button {
            margin: 0; /* ç§»é™¤æŒ‰é’®é»˜è®¤margin */
            padding: 3px 6px;
            font-size: 11px;
        }
        .page-size-select {
            padding: 2px 4px;
            font-size: 11px;
            margin-left: 8px;
        }
        .attention-item {
            padding: 8px 5px;
            border: 1px solid #ddd;
            margin: 2px 0;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px; /* å­—ä½“å˜å¤§ */
            font-weight: bold; /* å­—ä½“åŠ ç²— */
            display: flex; /* ä½¿ç”¨flexå¸ƒå±€ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }
        .attention-item:hover {
            background-color: #e9ecef;
        }
        .attention-item.selected {
            background-color: #d4edda;
            border-color: #28a745;
        }
        .error {
            color: red;
            margin: 10px 0;
            font-size: 12px;
        }
        .success {
            color: green;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
<div class="container">

    <div class="main-content">
        <!-- å·¦ä¾§é¢æ¿ -->
        <div class="left-panel">
            <!-- æ ‡é¢˜å¤´ï¼šå…¬å¸é€‰æ‹© -->
            <div class="header">
                <label>Company:</label>
                <input type="text" id="selectedCompany" placeholder="å…¬å¸åç§°">
            </div>

            <!-- ç¼–è¾‘å†…å®¹åŒºåŸŸ -->
            <div class="section">
                <div class="form-group">
                    <textarea id="companyContentInput" rows="10" placeholder="æš‚æ— å†å²å†…å®¹"></textarea>
                </div>
                <button class="save-btn" onclick="saveCompanyRecord()">ä¿å­˜</button> <!-- æ·»åŠ ç±»å -->

                <!-- é«˜çº§æœç´¢ -->
                <div style="margin-top: 10px;">
                    <button class="advanced-search-btn" onclick="toggleAdvancedSearch()">é«˜çº§æœç´¢</button> <!-- ç§»é™¤åŸç±»å -->
                </div>

                <!-- é«˜çº§æœç´¢è¡¨å• -->
                <div class="advanced-search" id="advancedSearchForm">
                    <div class="form-group">
                        <label>å¼€å§‹æ—¥æœŸ:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label>ç»“æŸæ—¥æœŸ:</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹å…³é”®å­—:</label>
                        <input type="text" id="contentKeyword" placeholder="æ¨¡ç³Šæœç´¢å†…å®¹">
                    </div>
                    <button onclick="queryCompanyRecords(true)">æŸ¥è¯¢å†å²è®°å½•</button>
                    <button class="cancel" onclick="hideAdvancedSearch()">å–æ¶ˆ</button>
                </div>
            </div>

            <!-- å…¬å¸è®°å½•åˆ—è¡¨ -->
            <div id="companyRecordsList"></div>
        </div>

        <!-- å³ä¾§é¢æ¿ -->
        <div class="right-panel">
            <!-- æ·»åŠ å…³æ³¨æŒ‰é’®å’Œè¡¨å• -->
            <div>
                <button class="add-attention-btn" onclick="toggleAttentionForm()">æ·»åŠ å…³æ³¨</button>

                <!-- æ·»åŠ å…³æ³¨è¡¨å• -->
                <div class="attention-form" id="attentionForm">
                    <div class="form-group">
                        <input type="text" id="attentionName" placeholder="å…¬å¸åç§°">
                    </div>
                    <button onclick="addAttention()">æ·»åŠ </button>
                    <button class="cancel" onclick="hideAttentionForm()">å–æ¶ˆ</button>
                </div>
            </div>

            <!-- å…³æ³¨åˆ—è¡¨ -->
            <div style="flex: 1; overflow-y: auto;"> <!-- å æ®å‰©ä½™ç©ºé—´å¹¶å…è®¸æ»šåŠ¨ -->
                <div id="attentionsList"></div>
                <div id="attentionPagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šå…¨å±€åˆ†é¡µæ§ä»¶ï¼Œæ”¾ç½®åœ¨é¡µé¢æœ€ä¸‹æ–¹ -->
    <div class="pagination" id="globalPagination"></div>

    <div id="message"></div>
</div>

<script>
    const API_BASE = 'http://localhost:8080/api';
    let selectedAttention = null;
    let currentQueryParams = {
        pageNum: 1,
        pageSize: 10,
        startDate: '',
        endDate: '',
        content: ''
    };
    let attentionPageParams = {
        pageNum: 1,
        pageSize: 20
    };

    // åˆ‡æ¢æ·»åŠ å…³æ³¨è¡¨å•æ˜¾ç¤º/éšè—
    function toggleAttentionForm() {
        const form = document.getElementById('attentionForm');
        if (form.classList.contains('show')) {
            hideAttentionForm();
        } else {
            form.classList.add('show');
        }
    }

    // éšè—æ·»åŠ å…³æ³¨è¡¨å•
    function hideAttentionForm() {
        const form = document.getElementById('attentionForm');
        form.classList.remove('show');
        document.getElementById('attentionName').value = '';
    }

    // åˆ‡æ¢é«˜çº§æœç´¢æ˜¾ç¤º/éšè—
    function toggleAdvancedSearch() {
        const form = document.getElementById('advancedSearchForm');
        if (form.classList.contains('show')) {
            hideAdvancedSearch();
        } else {
            form.classList.add('show');
        }
    }

    // éšè—é«˜çº§æœç´¢
    function hideAdvancedSearch() {
        const form = document.getElementById('advancedSearchForm');
        form.classList.remove('show');
        // æ¸…ç©ºé«˜çº§æœç´¢æ¡ä»¶å¹¶æŸ¥è¯¢ä»Šæ—¥è®°å½•
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.getElementById('contentKeyword').value = '';
        currentQueryParams.startDate = '';
        currentQueryParams.endDate = '';
        currentQueryParams.content = '';
        queryCompanyRecords(false);
    }

    // ä¿å­˜å…¬å¸è®°å½•
    async function saveCompanyRecord() {
        const company = document.getElementById('selectedCompany').value;
        const content = document.getElementById('companyContentInput').value;
        const today = new Date().toISOString().split('T')[0]; // å›ºå®šä¸ºå½“å‰æ—¥æœŸ

        if (!company || !content) {
            showMessage('è¯·å¡«å†™å…¬å¸åç§°å’Œå†…å®¹', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/company-records`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    currentDay: today,
                    company: company,
                    content: content
                })
            });

            if (response.ok) {
                const result = await response.text();
                showMessage(`ä»Šæ—¥è®°å½•ä¿å­˜æˆåŠŸ: ${result}`, 'success');
                // ä¿å­˜åæŸ¥è¯¢ä»Šæ—¥è®°å½•
                const today = new Date().toISOString().split('T')[0];
                currentQueryParams.startDate = today;
                currentQueryParams.endDate = today;
                currentQueryParams.pageNum = 1;
                queryCompanyRecords(false);
            } else {
                const error = await response.json();
                showMessage(`ä¿å­˜å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æŸ¥è¯¢ä»Šæ—¥å…¬å¸è®°å½•ï¼ˆç”¨äºç¼–è¾‘æ—¶é¢„å¡«å……å†…å®¹ï¼‰
    async function loadTodayContent(company) {
        const today = new Date().toISOString().split('T')[0];

        try {
            const params = new URLSearchParams({
                company: company,
                startDate: today,
                endDate: today,
                pageNum: 1,
                pageSize: 1
            });

            const response = await fetch(`${API_BASE}/company-records?${params}`);

            if (response.ok) {
                const data = await response.json();
                if (data.records && data.records.length > 0) {
                    const record = data.records[0];
                    document.getElementById('companyContentInput').value = record.content;
                } else {
                    // å¦‚æœä»Šå¤©æ²¡æœ‰è®°å½•ï¼Œæ¸…ç©ºå†…å®¹æ¡†
                    document.getElementById('companyContentInput').value = '';
                }
            }
        } catch (error) {
            console.error('åŠ è½½ä»Šæ—¥å†…å®¹å¤±è´¥:', error);
        }
    }

    // æŸ¥è¯¢å…¬å¸è®°å½•
    async function queryCompanyRecords(isAdvancedSearch) {
        const company = document.getElementById('selectedCompany').value;

        if (!company) {
            document.getElementById('companyRecordsList').innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">è¯·é€‰æ‹©å…¬å¸åç§°</div>';
            document.getElementById('globalPagination').innerHTML = ''; // æ¸…ç©ºå…¨å±€åˆ†é¡µ
            return;
        }

        const params = new URLSearchParams({
            company: company,
            pageNum: currentQueryParams.pageNum,
            pageSize: currentQueryParams.pageSize
        });

        // å¦‚æœæ˜¯é«˜çº§æœç´¢
        if (isAdvancedSearch) {
            if (currentQueryParams.startDate) params.append('startDate', currentQueryParams.startDate);
            if (currentQueryParams.endDate) params.append('endDate', currentQueryParams.endDate);
            if (currentQueryParams.content) params.append('content', currentQueryParams.content);
        }


        try {
            const response = await fetch(`${API_BASE}/company-records?${params}`);

            if (response.ok) {
                const data = await response.json();
                displayCompanyRecords(data);
            } else {
                const error = await response.json();
                showMessage(`æŸ¥è¯¢å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æ˜¾ç¤ºå…¬å¸è®°å½•
    function displayCompanyRecords(data) {
        const container = document.getElementById('companyRecordsList');
        // const paginationContainer = document.getElementById('companyPaginationControls');

        if (data.records.length === 0) {
            container.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">æ²¡æœ‰æ‰¾åˆ°è®°å½•</div>';
            document.getElementById('globalPagination').innerHTML = ''; // æ¸…ç©ºå…¨å±€åˆ†é¡µ
            return;
        }

        let html = '';
        data.records.forEach(record => {
            // è®¡ç®—è¯„è®ºæ•°é‡
            const commentCount = record.comments ? record.comments.length : 0;
            html += `
                    <div class="record-item">
                        <div class="record-header">
                            <span>${record.currentDay}  ${record.info || ''}</span> <!-- æ—¥æœŸå’Œinfoå­—æ®µåˆå¹¶ï¼Œç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†éš” -->
                        </div>
                        <div class="record-content">${record.content}</div>

                        <!-- è®°å½•å³ä¾§æ“ä½œåŒº -->
                        <div class="record-actions">
                            <button class="comment-icon-btn" onclick="toggleCommentForm(${record.id}, '${record.company}', '${record.currentDay}')">ğŸ’¬</button>
                            <button class="comments-toggle-btn" onclick="toggleComments(${record.id})">ğŸ‘ï¸ <span>(${commentCount})</span></button> <!-- è¯„è®ºå›¾æ ‡å’Œæ•°é‡ -->
                        </div>

                        <!-- è¯„è®ºè¡¨å• -->
                        <div class="comment-form" id="commentForm_${record.id}">
                            <textarea id="commentContent_${record.id}" placeholder="è¯„è®ºå†…å®¹" rows="2"></textarea>
                            <button onclick="addCompanyComment(${record.id}, '${record.company}', '${record.currentDay}')">æäº¤</button>
                            <button class="cancel" onclick="hideCommentForm(${record.id})">å–æ¶ˆ</button>
                        </div>

                        <!-- è¯„è®ºåŒºåŸŸ -->
                        <div class="comments-section">
                            <div class="comments-list" id="commentsList_${record.id}">
                                ${record.comments && record.comments.length > 0 ?
                record.comments.map(comment => `
                                        <div class="comment-item">
                                            <span class="comment-header">${comment.currentDay}</span>  <span class="comment-info">${comment.info || ''}</span> <!-- è¯„è®ºæ—¥æœŸå’Œinfoå­—æ®µåˆå¹¶ï¼Œç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†éš” -->
                                            <div class="comment-content">${comment.content}</div>
                                        </div>
                                    `).join('') :
                '<div style="padding: 5px; font-size: 11px; color: #666;">æš‚æ— è¯„è®º</div>'
            }
                            </div>
                        </div>
                    </div>
                `;
        });

        container.innerHTML = html;

        // ç”Ÿæˆåˆ†é¡µæ§ä»¶
        let paginationHtml = '';

        // ä¸Šä¸€é¡µ
        if (data.pageNum > 1) {
            paginationHtml += `<button onclick="changePage(${data.pageNum - 1})">ä¸Šä¸€é¡µ</button>`;
        }

        // é¡µç 
        for (let i = 1; i <= data.pages; i++) {
            if (i === data.pageNum) {
                paginationHtml += `<button style="background-color: #28a745; color: white;" onclick="changePage(${i})">${i}</button>`;
            } else {
                paginationHtml += `<button onclick="changePage(${i})">${i}</button>`;
            }
        }

        // ä¸‹ä¸€é¡µ
        if (data.pageNum < data.pages) {
            paginationHtml += `<button onclick="changePage(${data.pageNum + 1})">ä¸‹ä¸€é¡µ</button>`;
        }

        // æ¯é¡µå¤§å°é€‰æ‹©
        paginationHtml += `
                <select class="page-size-select" onchange="changePageSize(this.value)">
                    <option value="10" ${currentQueryParams.pageSize === 10 ? 'selected' : ''}>10æ¡</option>
                    <option value="20" ${currentQueryParams.pageSize === 20 ? 'selected' : ''}>20æ¡</option>
                    <option value="50" ${currentQueryParams.pageSize === 50 ? 'selected' : ''}>50æ¡</option>
                    <option value="100" ${currentQueryParams.pageSize === 100 ? 'selected' : ''}>100æ¡</option>
                </select>
            `;

        document.getElementById('globalPagination').innerHTML = paginationHtml;
    }

    // åˆ‡æ¢è¯„è®ºåŒºåŸŸæ˜¾ç¤º/éšè—
    function toggleComments(recordId) {
        const section = document.querySelector(`#commentsList_${recordId}`).closest('.comments-section');
        section.classList.toggle('expanded');
    }

    // åˆ‡æ¢è¯„è®ºè¡¨å•æ˜¾ç¤º/éšè—
    function toggleCommentForm(recordId, company, currentDay) {
        const form = document.getElementById(`commentForm_${recordId}`);
        if (form.classList.contains('show')) {
            form.classList.remove('show');
        } else {
            // éšè—å…¶ä»–è¯„è®ºè¡¨å•
            document.querySelectorAll('.comment-form').forEach(f => {
                f.classList.remove('show');
            });
            form.classList.add('show');
        }
    }

    // éšè—è¯„è®ºè¡¨å•
    function hideCommentForm(recordId) {
        const form = document.getElementById(`commentForm_${recordId}`);
        form.classList.remove('show');
    }

    // æ·»åŠ å…¬å¸è®°å½•è¯„è®º
    async function addCompanyComment(recordId, company, currentDay) {
        const commentContent = document.getElementById(`commentContent_${recordId}`).value;
        const today = new Date().toISOString().split('T')[0];

        if (!commentContent.trim()) {
            showMessage('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/company-records/${recordId}/comments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    company: company,
                    currentDay: today,
                    content: commentContent
                })
            });

            if (response.ok) {
                const result = await response.text();
                showMessage(`è¯„è®ºæ·»åŠ æˆåŠŸ: ${result}`, 'success');
                // æ¸…ç©ºè¯„è®ºè¾“å…¥æ¡†å¹¶éšè—è¡¨å•ï¼Œç„¶åé‡æ–°æŸ¥è¯¢è®°å½•
                document.getElementById(`commentContent_${recordId}`).value = '';
                hideCommentForm(recordId);
                queryCompanyRecords(false);
            } else {
                const error = await response.json();
                showMessage(`è¯„è®ºæ·»åŠ å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æ·»åŠ å…³æ³¨
    async function addAttention() {
        const name = document.getElementById('attentionName').value;

        if (!name) {
            showMessage('è¯·å¡«å†™å…¬å¸åç§°', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/attentions`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    type: 'company' // å›ºå®šä¸ºcompanyç±»å‹
                })
            });

            if (response.ok) {
                const result = await response.text();
                showMessage(`å…³æ³¨æ·»åŠ æˆåŠŸ: ${result}`, 'success');
                // æ¸…ç©ºè¾“å…¥æ¡†å¹¶éšè—è¡¨å•ï¼Œé‡æ–°æŸ¥è¯¢å…³æ³¨åˆ—è¡¨
                document.getElementById('attentionName').value = '';
                hideAttentionForm();
                queryAttentions();
            } else {
                const error = await response.json();
                showMessage(`æ·»åŠ å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æŸ¥è¯¢å…³æ³¨åˆ—è¡¨
    async function queryAttentions() {
        try {
            const params = new URLSearchParams({
                type: 'company', // å›ºå®šä¸ºcompanyç±»å‹
                pageNum: attentionPageParams.pageNum,
                pageSize: attentionPageParams.pageSize
            });

            const response = await fetch(`${API_BASE}/attentions?${params}`);

            if (response.ok) {
                const data = await response.json();
                displayAttentions(data);
            } else {
                const error = await response.json();
                showMessage(`æŸ¥è¯¢å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æ˜¾ç¤ºå…³æ³¨åˆ—è¡¨
    function displayAttentions(data) {
        const container = document.getElementById('attentionsList');
        const paginationContainer = document.getElementById('attentionPagination');

        if (data.records.length === 0) {
            container.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">æš‚æ— å…³æ³¨</div>';
            paginationContainer.innerHTML = '';
            return;
        }

        let html = '';
        data.records.forEach(attention => {
            const isSelected = selectedAttention === attention.name;
            html += `
                    <div class="attention-item ${isSelected ? 'selected' : ''}"
                         onclick="selectAttention('${attention.name}')">
                        <div>${attention.name}</div>
                        <!-- div style="font-size: 10px; color: #666;">${attention.times}æ¬¡</div> -->
                    </div>
                `;
        });

        container.innerHTML = html;

        // ç”Ÿæˆå…³æ³¨åˆ—è¡¨åˆ†é¡µæ§ä»¶
        let paginationHtml = '';

        // ä¸Šä¸€é¡µ
        if (data.pageNum > 1) {
            paginationHtml += `<button onclick="changeAttentionPage(${data.pageNum - 1})">ä¸Šä¸€é¡µ</button>`;
        }

        // é¡µç 
        for (let i = 1; i <= data.pages; i++) {
            if (i === data.pageNum) {
                paginationHtml += `<button style="background-color: #28a745; color: white;" onclick="changeAttentionPage(${i})">${i}</button>`;
            } else {
                paginationHtml += `<button onclick="changeAttentionPage(${i})">${i}</button>`;
            }
        }

        // ä¸‹ä¸€é¡µ
        if (data.pageNum < data.pages) {
            paginationHtml += `<button onclick="changeAttentionPage(${data.pageNum + 1})">ä¸‹ä¸€é¡µ</button>`;
        }

        paginationContainer.innerHTML = paginationHtml;
    }

    // é€‰ä¸­å…³æ³¨é¡¹
    function selectAttention(name) {
        selectedAttention = name;
        // æ›´æ–°UIæ˜¾ç¤ºé€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.attention-item').forEach(item => {
            item.classList.remove('selected');
        });
        event.target.closest('.attention-item').classList.add('selected');

        // å°†é€‰ä¸­çš„å…¬å¸åç§°å¡«å…¥å…¬å¸é€‰æ‹©æ¡†
        document.getElementById('selectedCompany').value = name;

        // åŠ è½½ä»Šå¤©çš„å†…å®¹åˆ°ç¼–è¾‘æ¡†
        loadTodayContent(name);

        // æŸ¥è¯¢ä»Šæ—¥è®°å½•
        const today = new Date().toISOString().split('T')[0];
        currentQueryParams.startDate = today;
        currentQueryParams.endDate = today;
        currentQueryParams.content = '';
        currentQueryParams.pageNum = 1;
        // éšè—é«˜çº§æœç´¢è¡¨å•
        document.getElementById('advancedSearchForm').classList.remove('show');
        queryCompanyRecords(false);
    }

    // æ”¹å˜é¡µç ï¼ˆå…¬å¸è®°å½•ï¼‰
    function changePage(pageNum) {
        currentQueryParams.pageNum = pageNum;
        queryCompanyRecords(false);
    }

    // æ”¹å˜æ¯é¡µå¤§å°ï¼ˆå…¬å¸è®°å½•ï¼‰
    function changePageSize(pageSize) {
        currentQueryParams.pageSize = parseInt(pageSize);
        currentQueryParams.pageNum = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
        queryCompanyRecords(false);
    }

    // æ”¹å˜é¡µç ï¼ˆå…³æ³¨åˆ—è¡¨ï¼‰
    function changeAttentionPage(pageNum) {
        attentionPageParams.pageNum = pageNum;
        queryAttentions();
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = message;
        messageDiv.className = type;

        // 3ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯
        setTimeout(() => {
            messageDiv.textContent = '';
            messageDiv.className = '';
        }, 3000);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // é»˜è®¤æŸ¥è¯¢å…³æ³¨åˆ—è¡¨ç¬¬ä¸€é¡µ
        queryAttentions();

        // ç›‘å¬å…¬å¸é€‰æ‹©è¾“å…¥æ¡†å˜åŒ–
        document.getElementById('selectedCompany').addEventListener('input', function() {
            const value = this.value.trim();
            if (value) {
                // åŠ è½½ä»Šå¤©çš„å†…å®¹åˆ°ç¼–è¾‘æ¡†
                loadTodayContent(value);

                // æŸ¥è¯¢ä»Šæ—¥è®°å½•
                const today = new Date().toISOString().split('T')[0];
                currentQueryParams.startDate = today;
                currentQueryParams.endDate = today;
                currentQueryParams.content = '';
                currentQueryParams.pageNum = 1;
                // éšè—é«˜çº§æœç´¢è¡¨å•
                document.getElementById('advancedSearchForm').classList.remove('show');
                queryCompanyRecords(false);
            } else {
                document.getElementById('companyRecordsList').innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">è¯·è¾“å…¥å…¬å¸åç§°</div>';
                document.getElementById('globalPagination').innerHTML = ''; // æ¸…ç©ºå…¨å±€åˆ†é¡µ
                document.getElementById('companyContentInput').value = '';
            }
        });
    });
</script>
</body>
</html>