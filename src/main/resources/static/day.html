<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px; /* å‡å°é¡µé¢å†…è¾¹è· */
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px; /* ç¼©å°æœ€å¤§å®½åº¦ */
            margin: 0 auto;
            background-color: white;
            padding: 15px; /* å‡å°å®¹å™¨å†…è¾¹è· */
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 15px; /* è°ƒæ•´æ ‡é¢˜ä¸‹æ–¹é—´è· */
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: center; /* å±…ä¸­å¯¹é½ */
            width: 100%; /* ä½¿ç”¨100%å®½åº¦ */
            margin: 0 auto 5px auto; /* å±…ä¸­margin */
        }

        .header label {
            font-size: 16px;
            font-weight: 600;
            margin-right: 15px;
            color: #333;
        }

        .header input {
            font-size: 20px;
            padding: 12px 15px;
            border: none;
            border-radius: 6px;
            outline: none;
            width: 80%;
            max-width: 600px; /* è®¾ç½®æœ€å¤§å®½åº¦ï¼Œä½¿å…¶å±…ä¸­æ—¶ä¸ä¼šè¿‡å®½ */
            transition: border-color 0.3s ease;
        }

        .header input:focus {
            border-color: #007bff;
        }

        .main-content {
            display: block; /* æ”¹ä¸ºå•åˆ—å¸ƒå±€ */
        }

        .left-panel {
            width: 100%; /* å æ»¡å®½åº¦ */
            min-width: 0;
        }

        .right-panel {
            display: none; /* éšè—å³ä¾§é¢æ¿ */
        }

        .section {
            margin-bottom: 15px; /* è°ƒæ•´ä¸‹æ–¹é—´è· */
            width: 100%;
        }

        .form-group {
            margin-bottom: 8px; /* è°ƒæ•´ä¸‹æ–¹é—´è· */
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 13px;
        }

        input, textarea, select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 13px;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 3px;
            margin-bottom: 3px;
            font-size: 12px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button.save-btn,
        button.advanced-search-btn {
            background-color: #6c757d;
        }

        button.save-btn:hover,
        button.advanced-search-btn:hover {
            background-color: #545b62;
        }

        button.comment-icon-btn,
        button.comments-toggle-btn {
            background-color: transparent;
            color: #6c757d;
            border: 1px solid #6c757d;
            padding: 2px 5px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        button.comment-icon-btn:hover,
        button.comments-toggle-btn:hover {
            background-color: #6c757d;
            color: white;
        }

        .advanced-search {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .advanced-search.show {
            display: block;
        }

        .comment-form {
            margin-top: 10px;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            display: none;
        }

        .comment-form.show {
            display: block;
        }

        .record-item {
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #fafafa;
            position: relative;
        }

        .record-header {
            font-weight: bold;
            margin-bottom: 3px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }

        .record-info {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            display: flex;
            justify-content: space-between;
        }

        .record-content {
            margin-bottom: 8px;
            font-size: 13px;
        }

        .comments-section {
            margin-top: 8px;
        }

        .comments-list {
            display: none;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #eee;
        }

        .comments-section.expanded .comments-list {
            display: block;
        }

        .comment-item {
            background-color: #dee2e6;
            padding: 5px;
            margin: 3px 0;
            border-radius: 3px;
            font-size: 12px;
        }

        .comment-header {
            font-weight: bold;
            margin-bottom: 2px;
            display: inline;
        }

        .comment-info {
            font-size: 10px;
            color: #666;
            margin-bottom: 2px;
            display: inline;
        }

        .comment-content {
            font-size: 12px;
        }

        .record-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .pagination {
            text-align: center;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap;
            gap: 2px;
        }

        .pagination button {
            margin: 0;
            padding: 3px 6px;
            font-size: 11px;
            background-color: #6c757d;
            color: white;
            border: 1px solid #6c757d;
        }

        .pagination button:hover {
            background-color: #545b62;
            border-color: #545b62;
        }

        .pagination button[style*="background-color: #28a745"] {
            background-color: #28a745 !important;
            color: white !important;
            border-color: #28a745 !important;
        }

        .pagination button[style*="background-color: #28a745"]:hover {
            background-color: #218838 !important;
            border-color: #218838 !important;
        }

        .page-size-select {
            padding: 3px 6px;
            font-size: 11px;
            margin-left: 5px;
            min-width: auto;
            width: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* ä¿®æ”¹æŒ‰é’®å®¹å™¨ä¸ºå±…ä¸­å¯¹é½ */
        .top-controls {
            display: flex;
            justify-content: center; /* æ”¹ä¸ºå±…ä¸­å¯¹é½ */
            align-items: flex-start;
            margin: 0 auto 10px; /* ä¿æŒæ°´å¹³å±…ä¸­ */
            width: 80%;
            max-width: 600px; /* ä¸ç¼–è¾‘æ¡†æœ€å¤§å®½åº¦ä¸€è‡´ */
            gap: 10px; /* æ·»åŠ æŒ‰é’®é—´è· */
        }

        #dailyContentInput {
            width: 80%;
            max-width: 600px; /* è®¾ç½®æœ€å¤§å®½åº¦ï¼Œä½¿å…¶å±…ä¸­æ—¶ä¸ä¼šè¿‡å®½ */
            margin: 0 auto 10px; /* å±…ä¸­margin */
            display: block;
            font-size: 20px;
            font-weight: bold;
            line-height: 1.6; /* æ·»åŠ è¡Œé—´è·ï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´æ•°å€¼ */
            letter-spacing: 0.5px; /* å­—ç¬¦é—´è·ï¼Œæ¨èå€¼ï¼š0.3px ~ 1px */
        }

        .error {
            color: red;
            margin: 10px 0;
            font-size: 12px;
        }

        .success {
            color: green;
            margin: 10px 0;
            font-size: 12px;
        }

        .hamburger-menu {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            transition: color 0.3s;
        }

        .hamburger-menu:hover {
            color: #007bff;
        }

        .nav-overlay {
            position: fixed;
            top: 0;
            right: -200px;
            width: 200px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 999;
            padding-top: 60px;
        }

        .nav-overlay.show {
            right: 0;
        }

        .nav-links {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .nav-link {
            padding: 10px 0;
            text-decoration: none;
            color: #333;
            font-size: 16px;
            border-bottom: 1px solid #eee;
            transition: color 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            color: #007bff;
            font-weight: bold;
        }

        .nav-link.active {
            color: #28a745;
        }

        .overlay-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
    </style>
</head>
<body>
<button class="hamburger-menu" onclick="toggleNav()">â˜°</button>
<div class="nav-overlay" id="navOverlay">
    <button class="overlay-close" onclick="toggleNav()">Ã—</button>
    <div class="nav-links">
        <a href="day.html" class="nav-link active">Day</a>
        <a href="company.html" class="nav-link">Company</a>
        <a href="industry.html" class="nav-link">Industry</a>
        <a href="product.html" class="nav-link">Product</a>
    </div>
</div>
<div class="container">
    <div class="main-content">
        <!-- å·¦ä¾§é¢æ¿ (ä¹Ÿæ˜¯å”¯ä¸€é¢æ¿) -->
        <div class="left-panel">
            <!-- æ ‡é¢˜å¤´ï¼šæ—¥æœŸé€‰æ‹© (è™½ç„¶æ²¡æœ‰è¾“å…¥æ¡†ï¼Œä½†é€»è¾‘ä¸Šæ˜¯åŸºäºæ—¥æœŸ) -->
            <div class="header">
                <label>å¤§ç›˜è®°å½•</label>
            </div>
            <!-- ç¼–è¾‘å†…å®¹åŒºåŸŸ -->
            <div class="section">
                <div style="text-align: center;">
                    <textarea id="dailyContentInput" rows="10" placeholder="è¯·è¾“å…¥"></textarea>
                </div>
                <!-- æ–°å¢ï¼šç”¨äºå¯¹é½æŒ‰é’®çš„å®¹å™¨ï¼Œè®¾ç½®ä¸ç¼–è¾‘æ¡†ç›¸åŒçš„å®½åº¦å¹¶å±…ä¸­ -->
                <div class="top-controls">
                    <button class="save-btn" onclick="saveDailyRecord()">ä¿å­˜</button>
                    <button class="advanced-search-btn" onclick="toggleAdvancedSearch()">ğŸ”</button>
                </div>
                <!-- é«˜çº§æœç´¢è¡¨å• -->
                <div class="advanced-search" id="advancedSearchForm">
                    <div class="form-group">
                        <label>å¼€å§‹æ—¥æœŸ:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label>ç»“æŸæ—¥æœŸ:</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹å…³é”®å­—:</label>
                        <input type="text" id="contentKeyword" placeholder="æ¨¡ç³Šæœç´¢å†…å®¹">
                    </div>
                    <button onclick="queryDailyRecords(true)">æŸ¥è¯¢å†å²è®°å½•</button>
                    <button class="cancel" onclick="hideAdvancedSearch()">å–æ¶ˆ</button>
                </div>
            </div>
            <!-- æ¯æ—¥è®°å½•åˆ—è¡¨ -->
            <div id="dailyRecordsList"></div>
        </div>
        <!-- å³ä¾§é¢æ¿ (éšè—) -->
        <!-- <div class="right-panel">

        </div> -->
    </div>
    <!-- æ–°å¢ï¼šå…¨å±€åˆ†é¡µæ§ä»¶ï¼Œæ”¾ç½®åœ¨é¡µé¢æœ€ä¸‹æ–¹ -->
    <div class="pagination" id="globalPagination"></div>
    <div id="message"></div>
</div>
<script>
    function toggleNav() {
        document.getElementById('navOverlay').classList.toggle('show');
    }

    // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­å¯¼èˆª
    document.addEventListener('click', function (event) {
        const navOverlay = document.getElementById('navOverlay');
        const hamburgerMenu = document.querySelector('.hamburger-menu');
        if (navOverlay.classList.contains('show') &&
            !navOverlay.contains(event.target) &&
            !hamburgerMenu.contains(event.target)) {
            navOverlay.classList.remove('show');
        }
    });
    const API_BASE = 'http://localhost:8080/api';
    // Daily é¡µé¢ä¸ä½¿ç”¨å…³æ³¨åˆ—è¡¨ï¼Œç§»é™¤ selectedAttention å˜é‡
    let currentQueryParams = {
        pageNum: 1,
        pageSize: 10,
        startDate: '',
        endDate: '',
        content: ''
    };

    // åˆ‡æ¢é«˜çº§æœç´¢æ˜¾ç¤º/éšè—
    function toggleAdvancedSearch() {
        const form = document.getElementById('advancedSearchForm');
        if (form.classList.contains('show')) {
            hideAdvancedSearch();
        } else {
            form.classList.add('show');
        }
    }

    // éšè—é«˜çº§æœç´¢
    function hideAdvancedSearch() {
        const form = document.getElementById('advancedSearchForm');
        form.classList.remove('show');
        // æ¸…ç©ºé«˜çº§æœç´¢æ¡ä»¶å¹¶æŸ¥è¯¢ä»Šæ—¥è®°å½•
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.getElementById('contentKeyword').value = '';
        currentQueryParams.startDate = '';
        currentQueryParams.endDate = '';
        currentQueryParams.content = '';
        queryDailyRecords(false);
    }

    // ä¿å­˜æ¯æ—¥è®°å½•
    async function saveDailyRecord() {
        const content = document.getElementById('dailyContentInput').value;
        const today = new Date().toISOString().split('T')[0]; // å›ºå®šä¸ºå½“å‰æ—¥æœŸ

        if (!content) {
            showMessage('è¯·å¡«å†™å†…å®¹', 'error');
            return;
        }
        try {
            const response = await fetch(`${API_BASE}/daily-records`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    currentDay: today,
                    content: content
                })
            });
            if (response.ok) {
                const result = await response.text();
                showMessage(`ä»Šæ—¥è®°å½•ä¿å­˜æˆåŠŸ: ${result}`, 'success');
                // ä¿å­˜åæŸ¥è¯¢ä»Šæ—¥è®°å½•
                const today = new Date().toISOString().split('T')[0];
                currentQueryParams.startDate = today;
                currentQueryParams.endDate = today;
                currentQueryParams.pageNum = 1;
                queryDailyRecords(false);
            } else {
                const error = await response.json();
                showMessage(`ä¿å­˜å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æŸ¥è¯¢ä»Šæ—¥æ¯æ—¥è®°å½•ï¼ˆç”¨äºç¼–è¾‘æ—¶é¢„å¡«å……å†…å®¹ï¼‰
    async function loadTodayContent() {
        const today = new Date().toISOString().split('T')[0];
        try {
            const params = new URLSearchParams({
                startDate: today,
                endDate: today,
                pageNum: 1,
                pageSize: 1
            });
            const response = await fetch(`${API_BASE}/daily-records?${params}`);
            if (response.ok) {
                const data = await response.json();
                if (data.records && data.records.length > 0) {
                    const record = data.records[0];
                    document.getElementById('dailyContentInput').value = record.content;
                } else {
                    // å¦‚æœä»Šå¤©æ²¡æœ‰è®°å½•ï¼Œæ¸…ç©ºå†…å®¹æ¡†
                    document.getElementById('dailyContentInput').value = '';
                }
            }
        } catch (error) {
            console.error('åŠ è½½ä»Šæ—¥å†…å®¹å¤±è´¥:', error);
        }
    }

    // æŸ¥è¯¢æ¯æ—¥è®°å½•
    async function queryDailyRecords(isAdvancedSearch) {
        const params = new URLSearchParams({
            pageNum: currentQueryParams.pageNum,
            pageSize: currentQueryParams.pageSize
        });
        // å¦‚æœæ˜¯é«˜çº§æœç´¢
        if (isAdvancedSearch) {
            if (currentQueryParams.startDate) params.append('startDate', currentQueryParams.startDate);
            if (currentQueryParams.endDate) params.append('endDate', currentQueryParams.endDate);
            if (currentQueryParams.content) params.append('content', currentQueryParams.content);
        } else {
            // éé«˜çº§æœç´¢ï¼ŒæŸ¥è¯¢ä»Šæ—¥è®°å½•
            const today = new Date().toISOString().split('T')[0];
            //params.append('startDate', today);
            //params.append('endDate', today);
        }
        try {
            const response = await fetch(`${API_BASE}/daily-records?${params}`);
            if (response.ok) {
                const data = await response.json();
                displayDailyRecords(data);
            } else {
                const error = await response.json();
                showMessage(`æŸ¥è¯¢å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æ˜¾ç¤ºæ¯æ—¥è®°å½•
    function displayDailyRecords(data) {
        const container = document.getElementById('dailyRecordsList');
        if (data.records.length === 0) {
            container.innerHTML = '<div style="padding: 10px; text-align: center; color: #666;">æ²¡æœ‰æ‰¾åˆ°è®°å½•</div>';
            document.getElementById('globalPagination').innerHTML = ''; // æ¸…ç©ºå…¨å±€åˆ†é¡µ
            return;
        }
        let html = '';
        data.records.forEach(record => {
            // è®¡ç®—è¯„è®ºæ•°é‡
            const commentCount = record.comments ? record.comments.length : 0;
            html += `
                    <div class="record-item">
                        <div class="record-header">
                            <span>${record.currentDay}  ${record.info || ''}</span> <!-- æ—¥æœŸå’Œinfoå­—æ®µåˆå¹¶ï¼Œç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†éš” -->
                        </div>
                        <div class="record-content">${record.content.replace(/\n/g, '<br>')}</div>
                        <!-- è®°å½•å³ä¾§æ“ä½œåŒº -->
                        <div class="record-actions">
                            <button class="comment-icon-btn" onclick="toggleCommentForm(${record.id}, '${record.currentDay}')">ğŸ’¬</button>
                            <button class="comments-toggle-btn" onclick="toggleComments(${record.id})">ğŸ‘ï¸ <span>(${commentCount})</span></button> <!-- è¯„è®ºå›¾æ ‡å’Œæ•°é‡ -->
                        </div>
                        <!-- è¯„è®ºè¡¨å• -->
                        <div class="comment-form" id="commentForm_${record.id}">
                            <textarea id="commentContent_${record.id}" placeholder="è¯„è®ºå†…å®¹" rows="2"></textarea>
                            <button onclick="addDailyComment(${record.id}, '${record.currentDay}')">æäº¤</button>
                            <button class="cancel" onclick="hideCommentForm(${record.id})">å–æ¶ˆ</button>
                        </div>
                        <!-- è¯„è®ºåŒºåŸŸ -->
                        <div class="comments-section">
                            <div class="comments-list" id="commentsList_${record.id}">
                                ${record.comments && record.comments.length > 0 ?
                record.comments.map(comment => `
                                        <div class="comment-item">
                                            <span class="comment-header">${comment.currentDay}</span>  <span class="comment-info">${comment.info || ''}</span> <!-- è¯„è®ºæ—¥æœŸå’Œinfoå­—æ®µåˆå¹¶ï¼Œç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†éš” -->
                                            <div class="comment-content">${comment.content}</div>
                                        </div>
                                    `).join('') :
                '<div style="padding: 5px; font-size: 11px; color: #666;">æš‚æ— è¯„è®º</div>'
            }
                            </div>
                        </div>
                    </div>
                `;
        });
        container.innerHTML = html;
        // ç”Ÿæˆåˆ†é¡µæ§ä»¶
        let paginationHtml = '';
        // ä¸Šä¸€é¡µ
        if (data.pageNum > 1) {
            paginationHtml += `<button onclick="changePage(${data.pageNum - 1})">ä¸Šä¸€é¡µ</button>`;
        }
        // é¡µç 
        for (let i = 1; i <= data.pages; i++) {
            if (i === data.pageNum) {
                paginationHtml += `<button style="background-color: #28a745; color: white;" onclick="changePage(${i})">${i}</button>`;
            } else {
                paginationHtml += `<button onclick="changePage(${i})">${i}</button>`;
            }
        }
        // ä¸‹ä¸€é¡µ
        if (data.pageNum < data.pages) {
            paginationHtml += `<button onclick="changePage(${data.pageNum + 1})">ä¸‹ä¸€é¡µ</button>`;
        }
        // æ¯é¡µå¤§å°é€‰æ‹©
        paginationHtml += `
                <select class="page-size-select" onchange="changePageSize(this.value)">
                    <option value="10" ${currentQueryParams.pageSize === 10 ? 'selected' : ''}>10æ¡</option>
                    <option value="20" ${currentQueryParams.pageSize === 20 ? 'selected' : ''}>20æ¡</option>
                    <option value="50" ${currentQueryParams.pageSize === 50 ? 'selected' : ''}>50æ¡</option>
                    <option value="100" ${currentQueryParams.pageSize === 100 ? 'selected' : ''}>100æ¡</option>
                </select>
            `;
        document.getElementById('globalPagination').innerHTML = paginationHtml;
    }

    // åˆ‡æ¢è¯„è®ºåŒºåŸŸæ˜¾ç¤º/éšè—
    function toggleComments(recordId) {
        const section = document.querySelector(`#commentsList_${recordId}`).closest('.comments-section');
        section.classList.toggle('expanded');
    }

    // åˆ‡æ¢è¯„è®ºè¡¨å•æ˜¾ç¤º/éšè—
    function toggleCommentForm(recordId, currentDay) {
        const form = document.getElementById(`commentForm_${recordId}`);
        if (form.classList.contains('show')) {
            form.classList.remove('show');
        } else {
            // éšè—å…¶ä»–è¯„è®ºè¡¨å•
            document.querySelectorAll('.comment-form').forEach(f => {
                f.classList.remove('show');
            });
            form.classList.add('show');
        }
    }

    // éšè—è¯„è®ºè¡¨å•
    function hideCommentForm(recordId) {
        const form = document.getElementById(`commentForm_${recordId}`);
        form.classList.remove('show');
    }

    // æ·»åŠ æ¯æ—¥è®°å½•è¯„è®º
    async function addDailyComment(recordId, currentDay) {
        const commentContent = document.getElementById(`commentContent_${recordId}`).value;
        const today = new Date().toISOString().split('T')[0];
        if (!commentContent.trim()) {
            showMessage('è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
            return;
        }
        try {
            const response = await fetch(`${API_BASE}/daily-records/${recordId}/comments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    currentDay: today,
                    content: commentContent
                })
            });
            if (response.ok) {
                const result = await response.text();
                showMessage(`è¯„è®ºæ·»åŠ æˆåŠŸ: ${result}`, 'success');
                // æ¸…ç©ºè¯„è®ºè¾“å…¥æ¡†å¹¶éšè—è¡¨å•ï¼Œç„¶åé‡æ–°æŸ¥è¯¢è®°å½•
                document.getElementById(`commentContent_${recordId}`).value = '';
                hideCommentForm(recordId);
                queryDailyRecords(false);
            } else {
                const error = await response.json();
                showMessage(`è¯„è®ºæ·»åŠ å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
            }
        } catch (error) {
            showMessage(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        }
    }

    // æ”¹å˜é¡µç ï¼ˆæ¯æ—¥è®°å½•ï¼‰
    function changePage(pageNum) {
        currentQueryParams.pageNum = pageNum;
        queryDailyRecords(false);
    }

    // æ”¹å˜æ¯é¡µå¤§å°ï¼ˆæ¯æ—¥è®°å½•ï¼‰
    function changePageSize(pageSize) {
        currentQueryParams.pageSize = parseInt(pageSize);
        currentQueryParams.pageNum = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
        queryDailyRecords(false);
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = message;
        messageDiv.className = type;
        // 3ç§’åè‡ªåŠ¨æ¸…é™¤æ¶ˆæ¯
        setTimeout(() => {
            messageDiv.textContent = '';
            messageDiv.className = '';
        }, 3000);
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
        // Daily é¡µé¢ä¸éœ€è¦é»˜è®¤æŸ¥è¯¢å…³æ³¨åˆ—è¡¨
        // é¡µé¢åŠ è½½æ—¶åŠ è½½ä»Šæ—¥å†…å®¹
        loadTodayContent();
        // æŸ¥è¯¢ä»Šæ—¥è®°å½•
        const today = new Date().toISOString().split('T')[0];
        currentQueryParams.startDate = today;
        currentQueryParams.endDate = today;
        currentQueryParams.pageNum = 1;
        queryDailyRecords(false);
    });
</script>
</body>
</html>